<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0a1020" />
  <title>ASTRA ‚Ä¢ HIREX ‚Äî High Resume eXpert v2.1.2</title>
  <meta name="description" content="HIREX generates ATS-safe, JD-aligned LaTeX resumes from your base_resume.tex using AI." />
  <meta name="author" content="Sri Akash Kadali" />

  <!-- CSP for local dev + API calls + blobs -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self' blob: data:;
          img-src 'self' data: blob:;
          style-src 'self' 'unsafe-inline';
          script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval';
          connect-src 'self'
                       blob:
                       http://127.0.0.1:8000 ws://127.0.0.1:8000
                       http://0.0.0.0:8000 ws://0.0.0.0:8000
                       http://localhost:8000 ws://localhost:8000;
          frame-src 'self' blob: data: about:;
          child-src 'self' blob:;
          worker-src 'self' blob:;
          media-src 'self' blob: data:;
          font-src 'self' data:;
          object-src 'none';
          base-uri 'self';
          frame-ancestors 'self';
        " />

  <link rel="icon" type="image/png" href="/static/assets/favicon.png" />
  <link rel="stylesheet" href="/static/css/base.css?v=2.1.2" />
  <link rel="stylesheet" href="/static/css/app.css?v=2.1.2" />

  <style>
    :root {
      --accent:#5bd0ff; --accent2:#9f78ff;
      --bg:#0a1020; --muted:rgba(255,255,255,0.7);
      --panel:rgba(255,255,255,0.05);
      --stroke:rgba(255,255,255,0.08);
      --glow:0 0 25px rgba(91,208,255,0.25);
    }

    body {
      background: radial-gradient(circle at 25% 20%, #0a1020 0%, #03060f 80%) fixed;
      color:#e4ecff; font-family:"Inter","Segoe UI",Roboto,sans-serif;
      line-height:1.6; overflow-x:hidden; margin:0; position:relative; min-height:100vh;
    }
    ::selection{ background:var(--accent); color:#000; }

    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        repeating-linear-gradient(to right, rgba(255,255,255,0.03) 0 1px, transparent 1px 80px),
        repeating-linear-gradient(to bottom, rgba(255,255,255,0.03) 0 1px, transparent 1px 80px);
    }
    body::after{
      content:""; position:fixed; width:450px; height:450px; top:25%; right:10%;
      background: radial-gradient(circle, rgba(91,208,255,0.15), transparent 70%);
      filter: blur(70px); animation: floatGlow 12s ease-in-out infinite alternate;
      z-index:0; pointer-events:none;
    }
    @keyframes floatGlow{ from{transform:translateY(0) scale(1);opacity:.9;} to{transform:translateY(-30px) scale(1.05);opacity:.7;} }

    /* Sidebar */
    .sidebar{ display:flex; flex-direction:column; padding-top:.25rem; }
    @media (min-width:880px){
      .sidebar{
        position:fixed; top:0; left:0; width:260px; height:100vh;
        background:rgba(10,16,32,0.65);
        border-right:1px solid rgba(255,255,255,0.05);
        backdrop-filter: blur(18px);
        z-index:5;
      }
      main.console, footer{ margin-left:260px; }
    }
    @media (max-width:879px){
      .sidebar{
        position:fixed; left:-100%; top:0; width:75%; height:100vh;
        background:rgba(10,16,32,0.95);
        transition:transform .3s ease, left .3s ease; z-index:20;
      }
      body.nav-open .sidebar{ left:0; }
    }

    .brand{ display:flex; align-items:center; gap:.75rem; padding:.6rem 1rem .05rem; }
    .brand img{
      width:72px; height:auto; aspect-ratio:1/1; object-fit:contain;
      filter: drop-shadow(0 0 6px rgba(91,208,255,0.6));
      transition: transform .25s, filter .25s;
    }
    .brand img:hover{ transform:scale(1.05); filter: drop-shadow(0 0 12px rgba(91,208,255,0.9)); }
    .logo-text{
      background: linear-gradient(90deg,var(--accent),var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-weight:700; font-size:1.35rem;
    }

    .vnav{ list-style:none; padding:0; margin:.05rem 1rem .75rem; }
    .vnav li{ margin-bottom:.42rem; }
    .vnav a{
      color:#cfd9ff; text-decoration:none; display:block;
      padding:.6rem 1rem; border-radius:10px;
      transition: background .2s, color .2s;
    }
    .vnav a:hover,.vnav a.active-link{
      background: rgba(91,208,255,0.15); color: var(--accent);
      box-shadow: 0 0 12px rgba(91,208,255,0.12);
    }

    .sidebar .cta-primary{
      display:block; margin:1rem; margin-top:auto; width:calc(100% - 2rem);
      background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#0a1020;
      border:none; border-radius:10px; padding:.6rem; font-weight:800; cursor:pointer;
      transition: transform .25s;
    }
    .sidebar .cta-primary:hover{ transform: translateY(-2px); }

    /* Danger button (Shutdown) */
    .cta-danger{
      background:linear-gradient(90deg,#ff6b6b,#ff3b3b);
      color:#0a1020; font-weight:800; padding:.6rem 1.4rem;
      border:none; border-radius:10px; cursor:pointer;
      box-shadow:0 0 12px rgba(255,107,107,0.25); transition:.2s;
      width:calc(100% - 2rem); margin:0 1rem 1rem;
    }
    .cta-danger:hover{ filter:brightness(1.1); }
    .cta-danger:disabled{ opacity:.6; cursor:not-allowed; }

    /* Hamburger for mobile */
    .hamburger{
      position:fixed; top:12px; left:16px; z-index:30;
      background:rgba(255,255,255,0.08); color:#eaf0ff;
      border:1px solid rgba(255,255,255,0.12); border-radius:10px;
      padding:.45rem .65rem; cursor:pointer; display:none;
      backdrop-filter: blur(8px);
    }
    @media(max-width:879px){ .hamburger{ display:block; } }

    /* Floating Shutdown FAB (always visible) */
    .shutdown-fab{
      position:fixed; right:18px; bottom:18px; z-index:30;
      background:linear-gradient(90deg,#ff6b6b,#ff3b3b);
      color:#0a1020; border:none; border-radius:999px;
      padding:.75rem 1rem; font-weight:800; cursor:pointer;
      box-shadow:0 6px 20px rgba(255,107,107,0.35);
    }
    .shutdown-fab:disabled{ opacity:.6; cursor:not-allowed; }

    /* Main */
    main.console{
      position:relative; z-index:2; padding:3rem 3rem 5rem;
      animation: fadeRise 1s ease; display:flex; flex-direction:column; align-items:center;
    }
    @keyframes fadeRise{ from{opacity:0; transform:translateY(25px);} to{opacity:1; transform:translateY(0);} }

    h1.page-title{
      font-size:2.4rem; font-weight:800;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-align:center; margin-bottom:.6rem;
    }
    .muted{ color:var(--muted); text-align:center; max-width:720px; margin-bottom:2rem; }

    .form-wrapper{
      width:100%; max-width:900px;
      background:var(--panel); border:1px solid rgba(255,255,255,0.05);
      border-radius:16px; padding:2rem;
      box-shadow:0 0 25px rgba(91,208,255,0.08);
      backdrop-filter:blur(10px);
    }

    form{ display:flex; flex-direction:column; gap:1.2rem; }
    label{ font-weight:600; color:#dce4ff; }

    textarea{
      width:100%; border-radius:10px; min-height:160px;
      background:rgba(0,0,0,.25); color:#eaf0ff;
      border:1px solid var(--stroke); padding:12px; font-size:15px; resize:vertical;
    }

    .options-row{ display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:.8rem; }

    .toggle{ display:flex; align-items:center; gap:.4rem; }
    .switch{ position:relative; width:48px; height:26px; }
    .switch input{ opacity:0; width:0; height:0; }
    .slider{ position:absolute; inset:0; cursor:pointer; background:#444; border-radius:26px; transition:.3s; }
    .slider:before{ content:""; position:absolute; height:20px; width:20px; left:3px; bottom:3px; background:white; border-radius:50%; transition:.3s; }
    input:checked + .slider{ background:var(--accent); }
    input:checked + .slider:before{ transform:translateX(22px); }
    .toggle-label{ font-size:13px; color:var(--muted); }

    .cta-buttons{ display:flex; gap:.8rem; justify-content:flex-end; margin-top:.5rem; }
    .cta-primary{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#0a1020; font-weight:800; padding:.6rem 1.4rem;
      border:none; border-radius:10px; cursor:pointer;
      box-shadow:0 0 12px rgba(91,208,255,0.25); transition:.2s;
    }
    .cta-primary:hover{ filter:brightness(1.2); }
    .cta-secondary{
      background:rgba(255,255,255,0.08); color:#eaf0ff;
      border:1px solid rgba(255,255,255,0.12); border-radius:10px;
      padding:.6rem 1.4rem; cursor:pointer;
    }

    footer{
      text-align:center; padding:2rem 1rem;
      color:#9aa7cc; border-top:1px solid rgba(255,255,255,0.05);
      backdrop-filter:blur(10px); font-size:.9rem;
      margin-left:260px;
    }

    @media(max-width:960px){
      .sidebar{ width:200px; }
      main.console, footer{ margin-left:200px; padding:2rem; }
    }
    @media(max-width:700px){
      .sidebar{ display:none; }
      main.console, footer{ margin-left:0; padding:1.5rem; }
    }
  </style>
</head>

<body class="page-enter">
  <!-- mobile hamburger -->
  <button id="nav-toggle" class="hamburger" aria-label="Toggle navigation" aria-controls="sidebar" aria-expanded="false">‚ò∞</button>

  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Primary">
    <div class="brand">
      <img src="/static/assets/logo.png" alt="ASTRA Logo" loading="lazy" />
      <span class="logo-text">ASTRA</span>
    </div>

    <ul class="vnav">
      <li><a href="/index.html" class="active-link" aria-current="page">üè† HIREX</a></li>
      <li><a href="/preview.html">üìÑ HIREX Preview</a></li>
      <li><a href="/coverletter.html">‚úâÔ∏è HIREX Letter</a></li>
      <li><a href="/talk.html">üí¨ Talk to HIREX</a></li>
      <li><a href="/mastermind.html">üß† MasterMind</a></li>
      <li><a href="/superhuman.html">‚ú® SuperHuman</a></li>
      <li><a href="/dashboard.html">üìä Dashboard</a></li>
      <li><a href="/genie.html">üßû Genie</a></li>
    </ul>

    <button class="cta-primary" type="button" onclick="document.getElementById('jd').focus()">üöÄ Get Started</button>
    <!-- Shutdown button in sidebar -->
    <button id="shutdown-btn" class="cta-danger" type="button" title="Stop ASTRA server">‚èª Shutdown Server</button>
  </aside>

  <main class="console" role="main">
    <h1 class="page-title">HIREX ‚Äî High Resume eXpert</h1>
    <p class="muted">
      Paste your <strong>Job Description</strong> below. HIREX uses your canonical
      <code>base_resume.tex</code> to produce an ATS-safe, JD-aligned version.
    </p>

    <div class="form-wrapper">
      <form id="optimize-form" novalidate>
        <label for="jd">Job Description</label>
        <textarea id="jd" name="jd" placeholder="Paste full job description here‚Ä¶" required aria-required="true"></textarea>

        <div class="options-row">
          <div class="toggle">
            <label class="switch" aria-label="Enable Humanize API">
              <input type="checkbox" id="humanize_toggle_main" />
              <span class="slider" aria-hidden="true"></span>
            </label>
            <span class="toggle-label">Enable Humanize API</span>
          </div>

          <div class="cta-buttons">
            <button type="submit" class="cta-primary">üöÄ Optimize Resume</button>
            <button type="reset" class="cta-secondary">Reset</button>
          </div>
        </div>

        <input type="hidden" id="use_humanize_state" name="use_humanize" value="false" />
      </form>
    </div>
  </main>

  <footer>
    ¬© 2025 <strong>ASTRA</strong> ‚Äî Developed by <strong>Sri Akash Kadali</strong> |
    Powered by <strong>FastAPI</strong> + <strong>OpenAI</strong> + <strong>LaTeX</strong>
  </footer>

  <!-- Toast container for unified UI layer -->
  <div id="toast" role="status" aria-live="polite"></div>

  <!-- Always-visible Shutdown FAB -->
  <button id="shutdown-fab" class="shutdown-fab" type="button" aria-label="Shutdown server">‚èª</button>

  <!-- Load utilities and UI helpers before main logic -->
  <script src="/static/js/util.js?v=2.1.2" defer></script>
  <script src="/static/js/ui.js?v=2.1.2" defer></script>
  <script src="/static/js/main.js?v=2.1.2" defer></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("humanize_toggle_main");
      const hidden = document.getElementById("use_humanize_state");

      // Read both new (on/off) and legacy (true/false) keys; default ON
      const a = localStorage.getItem("hirex-use-humanize");     // "on" | "off"
      const b = localStorage.getItem("hirex_use_humanize");     // "true" | "false"
      const startOn = (a === "on") || (b === "true") || (a === null && b === null);

      toggle.checked = startOn;
      hidden.value = startOn ? "true" : "false";

      toggle.addEventListener("change", () => {
        const on = toggle.checked;
        // Persist in both formats for backward/forward compatibility
        localStorage.setItem("hirex-use-humanize", on ? "on" : "off");
        localStorage.setItem("hirex_use_humanize", on ? "true" : "false");
        hidden.value = on ? "true" : "false";
        document.dispatchEvent(new CustomEvent("hirex:humanize-change", { detail: { on } }));
        (window.HIREX?.toast || ((m)=>alert(m)))(on ? "üßë‚Äçüíº Humanize Enabled" : "‚öôÔ∏è Optimize Only");
      });

      // Mobile nav toggle
      const navToggle = document.getElementById("nav-toggle");
      navToggle?.addEventListener("click", () => {
        const on = !document.body.classList.contains("nav-open");
        document.body.classList.toggle("nav-open", on);
        navToggle.setAttribute("aria-expanded", String(on));
      });

      // Unified shutdown handler for both buttons
      const wireShutdown = (btn) => {
        if (!btn) return;
        btn.addEventListener("click", async () => {
          if (!confirm("Shut down the ASTRA server now?")) return;
          const prevText = btn.textContent;
          btn.disabled = true;
          if (btn.id === "shutdown-btn") btn.textContent = "‚èª Shutting down‚Ä¶";
          try {
            const res = await fetch("/api/system/shutdown", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ reason: "user_request" })
            });
            if (!res.ok) throw new Error("Shutdown endpoint failed");
            (window.HIREX?.toast || ((m)=>alert(m)))("üõë Server shutting down‚Ä¶");
            setTimeout(() => {
              window.close();
              window.location.href = "about:blank";
            }, 800);
          } catch (e) {
            (window.HIREX?.toast || ((m)=>alert(m)))("‚ö†Ô∏è Couldn‚Äôt reach shutdown endpoint.");
            btn.disabled = false;
            btn.textContent = prevText;
          }
        });
      };

      wireShutdown(document.getElementById("shutdown-btn"));
      wireShutdown(document.getElementById("shutdown-fab"));
    });
  </script>
</body>
</html>
